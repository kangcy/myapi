(function(doc, win) {
	var docEl = doc.documentElement,
		resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize',
		recalc = function() {
			var clientWidth = document.getElementsByTagName("html")[0].clientWidth - document.getElementsByTagName("html")[0].offsetLeft * 2;
			if(!clientWidth) return;
			docEl.style.fontSize = 16 * (clientWidth / 320) + 'px';
			docEl.style.width = '100%';
			docEl.style.height = '100%';
		};
	if(!doc.addEventListener) {
		return;
	}
	win.addEventListener(resizeEvt, recalc, false);
	doc.addEventListener('DOMContentLoaded', recalc, false);
	(function() {
		return;
		var dpr = scale = 1;
		var isIPhone = win.navigator.appVersion.match(/iphone/gi);
		var devicePixelRatio = win.devicePixelRatio;
		if(isIPhone) {
			// iOS下，对于2和3的屏，用2倍的方案，其余的用1倍方案
			if(devicePixelRatio >= 3 && (!dpr || dpr >= 3)) {
				dpr = 3;
			} else if(devicePixelRatio >= 2 && (!dpr || dpr >= 2)) {
				dpr = 2;
			} else {
				dpr = 1;
			}
		} else {
			dpr = 1;
		}
		scale = 1 / dpr;
		var metaEl = "";
		metaEl = doc.createElement('meta');
		metaEl.setAttribute('name', 'viewport');
		metaEl.setAttribute('content', 'initial-scale=' + scale + ', maximum-scale=' + scale + ', minimum-scale=' + scale + ', user-scalable=no');
		if(docEl.firstElementChild) {
			docEl.firstElementChild.appendChild(metaEl);
		} else {
			var wrap = doc.createElement('div');
			wrap.appendChild(metaEl);
			doc.write(wrap.innerHTML);
		}
	})();

})(document, window);

var RootUrl = "http://localhost/app/";

function GetParameter(param) {
	var query = window.location.search;
	query = doFilter(query);
	var iLen = param.length;
	var iStart = query.indexOf(param);
	if(iStart == -1) {
		return "";
	}
	iStart += iLen + 1;
	var iEnd = query.indexOf("&", iStart);
	if(iEnd == -1) {
		return query.substring(iStart);
	}
	return query.substring(iStart, iEnd);
};

function doFilter(query) {
	var queryParam = query.split('?');
	if(queryParam.length > 1) {
		var _index = query.indexOf("?") + 1;
		var queryBefore = query.substr(0, _index);
		var queryAfter = query.substr(_index);
		queryAfter = queryAfter.replace("?", "&");
		query = queryBefore + queryAfter;
	}
	return query;
};

function Download() {
	window.location.href = "http://app.qq.com/#id=detail&appid=1106027124";
}

function CheckPowerPwd(articleid, pwd, callback) {
	mui.getJSON(RootUrl + "Article/CheckPowerPwd", {
		ArticleID: articleid,
		ArticlePowerPwd: pwd
	}, function(data) {
		if(data != null) {
			if(data.result) {
				if(callback) {
					callback();
				}
				return;
			}
		}
		mui.toast("校验失败");
	});
}

function UnicodeText(str) {
	return escape(str).toLocaleLowerCase().replace(/%u/gi, '\\u');
}

function UnUnicodeText(str) {
	if(base.IsNullOrEmpty(str)) {
		return "";
	}
	return unescape(str.replace(/\\u/gi, '%u'));
}

/**
 * 动态加载JS 
 * url：JS地址
 * callback：回调方法
 */
function LoadScript(url, callback) {
	var script = document.createElement("script");
	script.type = "text/javascript";
	if(typeof(callback) != "undefined") {
		if(script.readyState) {
			script.onreadystatechange = function() {
				if(script.readyState == "loaded" || script.readyState == "complete") {
					script.onreadystatechange = null;
					callback();
				}
			};
		} else {
			script.onload = function() {
				callback();
			};
		}
	}
	script.src = url;
	document.body.appendChild(script);
}

//播放器
var audio = null;
var timestamp = 0;

function switchsound() {
	if(audio == null) {
		audio = document.createElement('audio');
		audio.id = 'bgsound';
		audio.loop = 'loop';
		audio.innerHTML = '<source src="' + MusicUrl + '" type="audio/mpeg">';
		document.body.appendChild(audio);
	}

	if(audio.paused) {
		audio.play();
		document.getElementById(MusicID).setAttribute("play", "stop");
	} else if(new Date().getTime() > timestamp + 1000) {
		audio.pause();
		document.getElementById(MusicID).setAttribute("play", "on");
	}
}

function stopsound() {
	if(audio != null) {
		audio.pause();
	}
	document.getElementById(MusicID).setAttribute("play", "on");
}

function startsound() {
	document.removeEventListener('touchstart', startsound);
	if(audio == null) {
		audio = document.createElement('audio');
		audio.id = 'bgsound';
		audio.src = MusicUrl;
		audio.loop = 'loop';
		document.body.appendChild(audio);
	}
	audio.play();
	document.getElementById(MusicID).setAttribute('play', 'stop');
	timestamp = new Date().getTime();
}

var base = new function() {
	this.Get = function(name) {
		if(name.indexOf('.') < 0) {
			return mui("#" + name)[0];
		} else {
			return mui(name);
		}
	}
	this.ShowThumb = function(url, thumb) {
		if(base.IsNullOrEmpty(url)) {
			return "img/logo.png";
		}
		if(url.indexOf('_0') < 0) {
			return url;
		}
		url = url.replace("_0", "_" + thumb);
		if(url.toString().toLowerCase().indexOf("http://") < 0) {
			url = "http://www.xiaoweipian.com/" + url;
		}
		return url;
	}
	this.IsNullOrEmpty = function(str) {
		if(!str) {
			return true;
		}
		if(str == "") {
			return true;
		}
		if(str.toString().toLowerCase() == "null") {
			return true;
		}
		return false;
	}
}